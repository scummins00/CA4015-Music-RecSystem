
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Collaborative Filtering - Matrix Factorization &#8212; CA4015 Music Recommender System</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Deep Neural Network Recommender System" href="Deep_Learning_Recommender_System.html" />
    <link rel="prev" title="Preliminary Data Analysis" href="Preliminary_Data_Analysis.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">CA4015 Music Recommender System</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Introduction
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Preliminary_Data_Analysis.html">
   Preliminary Data Analysis
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Collaborative Filtering - Matrix Factorization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Deep_Learning_Recommender_System.html">
   Deep Neural Network Recommender System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Advanced_Deep_Learning_Recommender_System.html">
   Advanced Deep Learning Recommender System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="conclusions.html">
   Conclusions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Matrix_Factorization.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FMatrix_Factorization.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/Matrix_Factorization.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Collaborative Filtering - Matrix Factorization
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-engineering">
     Feature Engineering
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-problem-with-rating-values">
     The Problem With Rating Values
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#adding-genres-to-artists">
       Adding Genres to Artists
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#artist-total-listens-value">
       Artist Total Listens Value
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#collaborative-filtering-model">
   Collaborative Filtering Model
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#current-model-predictions">
     Current Model Predictions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#norm-analysis">
     Norm Analysis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regularisation">
     Regularisation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#regularised-model-analysis">
       Regularised Model Analysis
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dot-product-comparison-of-embeddings-in-regularised-and-unregularised">
       Dot Product Comparison of Embeddings in Regularised and Unregularised
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cosine-comparison-of-embeddings-in-regularised-and-unregularised">
       Cosine Comparison of Embeddings in Regularised and Unregularised
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#norm-embedding-analysis">
     Norm Embedding Analysis
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="collaborative-filtering-matrix-factorization">
<h1>Collaborative Filtering - Matrix Factorization<a class="headerlink" href="#collaborative-filtering-matrix-factorization" title="Permalink to this headline">¶</a></h1>
<p>In this Notebook, we will be performing collaborative filtering using matrix factorization. The steps we will follow are detailed in the introduction. We will be using TensorFlow as our ML framework for the development of our music recommender system. Let’s begin by importing our packages, and building a sparse representation of our ratings matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow.compat.v1</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">import</span> <span class="nn">sklearn.manifold</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">disable_eager_execution</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We are importing a range of helper functions in the below cell. These functions are defined in <code class="docutils literal notranslate"><span class="pre">CFUtils.py</span></code>, and <code class="docutils literal notranslate"><span class="pre">CFModel.py</span></code>, both of which can be found in the <a class="reference external" href="https://github.com/scummins00/CA4015-Music-RecSystem">Github Repository</a> for this assignment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Let&#39;s import our helper functions defined externally</span>
<span class="kn">from</span> <span class="nn">CFUtils</span> <span class="kn">import</span> <span class="n">build_rating_sparse_tensor</span><span class="p">,</span> <span class="n">split_dataframe</span><span class="p">,</span> <span class="n">sparse_mean_square_error</span><span class="p">,</span> <span class="n">build_model</span><span class="p">,</span> <span class="n">item_neighbors</span><span class="p">,</span> <span class="n">user_recommendations</span>
<span class="kn">from</span> <span class="nn">CFModel</span> <span class="kn">import</span> <span class="n">CFModel</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add some convenience functions to Pandas DataFrame.</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
<span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a filtered dataframe, by applying function to key&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">function</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">])]</span>

<span class="k">def</span> <span class="nf">flatten_cols</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">flatten_cols</span> <span class="o">=</span> <span class="n">flatten_cols</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="feature-engineering">
<h2>Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this headline">¶</a></h2>
<p>In the following cells, we will be re-mapping our user ID’s to fit into a scale that is defined as <span class="math notranslate nohighlight">\([0, m]\)</span>, where <span class="math notranslate nohighlight">\(m\)</span> is our number of unique users. Currently, despite there being only 1,892 unique users, profiles exist with ID’s such as 1,893, 2,000, and so on. This is an issue because when we generate our ratings matrix, we will be creating rows that do not represent any users. Mapping our user ID’s to a suitable scale is good practice and will avoid issues in the future.</p>
<p>The case is the same for artist ID’s with them not being presented in a contiguous order. We will apply the same principal above to remap our artist ID’s to the correct scale.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Let&#39;s define our amount of users</span>
<span class="n">rating_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/user_artists.dat&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
<span class="n">num_users</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rating_matrix</span><span class="o">.</span><span class="n">userID</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="c1">#Extract userID column</span>
<span class="n">userids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rating_matrix</span><span class="o">.</span><span class="n">userID</span><span class="p">)</span>

<span class="c1">#Remap the column</span>
<span class="n">u_mapper</span><span class="p">,</span> <span class="n">u_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">userids</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Let&#39;s define our amount of artists</span>
<span class="n">artists</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/artists.dat&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
<span class="n">artists</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="s1">&#39;artistID&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">num_artists</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">artists</span><span class="o">.</span><span class="n">artistID</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="c1">#Extract artistID column</span>
<span class="n">artistids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rating_matrix</span><span class="o">.</span><span class="n">artistID</span><span class="p">)</span>

<span class="c1">#Remap the column</span>
<span class="n">a_mapper</span><span class="p">,</span> <span class="n">a_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">artistids</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Assert that u_ind and userID column are of same size</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u_ind</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rating_matrix</span><span class="o">.</span><span class="n">userID</span><span class="p">))</span>

<span class="c1">#Assert that a_ind and artistID column are of same size</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_ind</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rating_matrix</span><span class="o">.</span><span class="n">artistID</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s replace old columns with new ind ones</span>
<span class="n">rating_matrix</span><span class="o">.</span><span class="n">userID</span> <span class="o">=</span> <span class="n">u_ind</span>
<span class="n">rating_matrix</span><span class="o">.</span><span class="n">artistID</span> <span class="o">=</span> <span class="n">a_ind</span>

<span class="c1">#Let&#39;s ensure the max value is approriate</span>
<span class="k">assert</span><span class="p">(</span><span class="n">rating_matrix</span><span class="o">.</span><span class="n">userID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1891</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="n">rating_matrix</span><span class="o">.</span><span class="n">artistID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mi">17631</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-problem-with-rating-values">
<h2>The Problem With Rating Values<a class="headerlink" href="#the-problem-with-rating-values" title="Permalink to this headline">¶</a></h2>
<p>For this collaborative filtering model, I would have liked to make use of the explicit rating data available in the ‘weight’ column of the ratings matrix. Through trial and error, I’ve come to the conclusion that using this data explicitly will not create an effective recommendation system.</p>
<p>The reason for this is to do with the the distribution of user to artist listens. Many user to artist combinations have only a value of 1 for the ‘weight’ column. When aggregating the total listens for artists by summing the weights, we see a huge portion of the artists still only have 1 or so listens, whilst popular artists such as Katy Perry, Lady Gaga, and Britney Spears, can accumulate millions of listens, Britney Spears coming out on top with 2.4 million listens from users in this dataset. This problem is known as the <em>Long Tail Problem</em> <span id="id1">[<a class="reference internal" href="bibliography.html#id15">Anderson, 2006</a>]</span>.</p>
<p>Intuitively, this is not suitable for a recommendation system because in this case if we ignore the outliers, we are ignoring the most important features of the dataset. Normalising our ‘weight’ column has little-to-no effect on performance as squashing such disparate values into a smaller range does not fix the disparity.</p>
<p>Another approach is to use a binary representation of the ratings matrix. If a user has ever listened to an artist, the ‘listened’ column receives a value of 1. Otherwise, the value is 0. This approach does result in some information loss, as we are no longer aware of how regular of a listener a user is to a particular artist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#We&#39;re going to make a binary representation of the matrix. If the user ever listened to the artist, they get a value of 1. 0 otherwise</span>
<span class="n">rating_matrix</span><span class="p">[</span><span class="s1">&#39;listened&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rating_matrix</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userID</th>
      <th>artistID</th>
      <th>weight</th>
      <th>listened</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>92834.000</td>
      <td>92834.000</td>
      <td>92834.000</td>
      <td>92834.000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>944.222</td>
      <td>3235.737</td>
      <td>745.244</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>std</th>
      <td>546.751</td>
      <td>4197.217</td>
      <td>3751.322</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>470.000</td>
      <td>430.000</td>
      <td>107.000</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>944.000</td>
      <td>1237.000</td>
      <td>260.000</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1416.000</td>
      <td>4266.000</td>
      <td>614.000</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1891.000</td>
      <td>17631.000</td>
      <td>352698.000</td>
      <td>1.000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="adding-genres-to-artists">
<h3>Adding Genres to Artists<a class="headerlink" href="#adding-genres-to-artists" title="Permalink to this headline">¶</a></h3>
<p>For visualisating our recommendations, we will view the dispersion of genres in latent space. This will allow us to understand if music of similar genres generally cluster around each other. For this, we would like to be able to join our artists and genres tables.</p>
<p>We must firstly merge the <code class="docutils literal notranslate"><span class="pre">tags.dat</span></code> data with the <code class="docutils literal notranslate"><span class="pre">user_taggedartists.dat</span></code> data. We then <code class="docutils literal notranslate"><span class="pre">groupby</span></code> artist name and use a lambda function to list the genres for that artist. It should be noted that <code class="docutils literal notranslate"><span class="pre">user_taggedartists.dat</span></code> is user-generated information, and therefore may contain some innacurate or unimportant artist tags. To counteract this, we will only be including a tag as part of the artists genre if it has been associated with that artist on 3 or more seperate occasions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Let&#39;s read in genres and tags</span>
<span class="n">genres</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/tags.dat&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
<span class="n">artists_tagged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/user_taggedartists.dat&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Let&#39;s match artists to genres</span>
<span class="n">artists_tagged</span> <span class="o">=</span> <span class="n">artists_tagged</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">genres</span><span class="p">[[</span><span class="s1">&#39;tagID&#39;</span><span class="p">,</span> <span class="s1">&#39;tagValue&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;tagID&#39;</span><span class="p">)</span>
<span class="n">artists_tagged</span> <span class="o">=</span> <span class="p">(</span><span class="n">artists_tagged</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;artistID&#39;</span><span class="p">)[</span><span class="s1">&#39;tagValue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">grp</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">grp</span><span class="p">)))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We know that as tags are applied by users, they can be innaccurate and messy. In the following cell we perform these actions:</p>
<ol class="simple">
<li><p>Loop through each artist in our <code class="docutils literal notranslate"><span class="pre">artists_tagged</span></code> table</p></li>
<li><p>Create a dictionary for that artist’s tags</p></li>
<li><p>Count the tags using the dictionary</p></li>
<li><p>Order the artist tags by number of appearances and save them in a <code class="docutils literal notranslate"><span class="pre">new_tags</span></code> variable.</p></li>
<li><p>The artist receives the <code class="docutils literal notranslate"><span class="pre">new_tags</span></code> variable (“No Tags” string if list is empty.)</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">artists_tagged</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">new_tags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">tagValue</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">new_tags</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">])</span>
    <span class="n">new_tags</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">new_tags</span><span class="p">:</span>
        <span class="n">artists_tagged</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;tagValue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">new_tags</span><span class="p">]</span>
        <span class="n">artists_tagged</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;genre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">artists_tagged</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;tagValue&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Let&#39;s add these tags to our artists</span>
<span class="n">artists</span> <span class="o">=</span> <span class="n">artists</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">artists_tagged</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">artists</span><span class="o">.</span><span class="n">tagValue</span> <span class="o">=</span> <span class="n">artists</span><span class="o">.</span><span class="n">tagValue</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;No Tags&#39;</span><span class="p">)</span>
<span class="n">artists</span><span class="o">.</span><span class="n">genre</span> <span class="o">=</span> <span class="n">artists</span><span class="o">.</span><span class="n">genre</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;No Tags&#39;</span><span class="p">)</span>
<span class="n">artists</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;artistIDright&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="s1">&#39;pictureURL&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">artists</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tagValue&#39;</span><span class="p">:</span> <span class="s1">&#39;genres&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">artists</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>artistID</th>
      <th>name</th>
      <th>genres</th>
      <th>genre</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>MALICE MIZER</td>
      <td>[darkwave, german, gothic]</td>
      <td>darkwave</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Diary of Dreams</td>
      <td>[black metal]</td>
      <td>black metal</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Carpathian Forest</td>
      <td>[j-rock, japanese, visual kei, gothic]</td>
      <td>j-rock</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Moi dix Mois</td>
      <td>[darkwave]</td>
      <td>darkwave</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Bella Morte</td>
      <td>[gothic metal, doom metal, black metal]</td>
      <td>gothic metal</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17627</th>
      <td>18741</td>
      <td>Diamanda GalÃ¡s</td>
      <td>No Tags</td>
      <td>No Tags</td>
    </tr>
    <tr>
      <th>17628</th>
      <td>18742</td>
      <td>Aya RL</td>
      <td>No Tags</td>
      <td>No Tags</td>
    </tr>
    <tr>
      <th>17629</th>
      <td>18743</td>
      <td>Coptic Rain</td>
      <td>No Tags</td>
      <td>No Tags</td>
    </tr>
    <tr>
      <th>17630</th>
      <td>18744</td>
      <td>Oz Alchemist</td>
      <td>No Tags</td>
      <td>No Tags</td>
    </tr>
    <tr>
      <th>17631</th>
      <td>18745</td>
      <td>Grzegorz Tomczak</td>
      <td>No Tags</td>
      <td>No Tags</td>
    </tr>
  </tbody>
</table>
<p>17632 rows × 4 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="artist-total-listens-value">
<h3>Artist Total Listens Value<a class="headerlink" href="#artist-total-listens-value" title="Permalink to this headline">¶</a></h3>
<p>Later on we will use an artists total number of listens as part of our visualisations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Let&#39;s groupby artist ID and sum weight for their total listens</span>
<span class="n">artist_tot_listens</span> <span class="o">=</span> <span class="n">rating_matrix</span><span class="p">[[</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;artistID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="c1">#Let&#39;s also add the artist name for clarity</span>
<span class="n">artist_tot_listens</span> <span class="o">=</span> <span class="n">artist_tot_listens</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">artists</span><span class="p">,</span> <span class="n">lsuffix</span><span class="o">=</span><span class="s1">&#39;artistID&#39;</span><span class="p">,</span> <span class="n">rsuffix</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="collaborative-filtering-model">
<h1>Collaborative Filtering Model<a class="headerlink" href="#collaborative-filtering-model" title="Permalink to this headline">¶</a></h1>
<p>At this point, we are ready to build a very basic first version of our collaborative filtering model. In the below code, we will be using a modified version of the <code class="docutils literal notranslate"><span class="pre">build_model</span></code> function defined in <code class="docutils literal notranslate"><span class="pre">CFUtils.py</span></code>. We modified this function to include two extra parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">num_queries</span></code> - Defined as the number of users in our case. Used to define the length of the <span class="math notranslate nohighlight">\(U\)</span> user embedding.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_items</span></code> - Defined as the number of artists in our case. Used to define the length of the <span class="math notranslate nohighlight">\(V\)</span> item embedding.</p></li>
</ul>
<p>The helper functions in <code class="docutils literal notranslate"><span class="pre">CFUtils.py</span></code>, and the <code class="docutils literal notranslate"><span class="pre">CFModel</span></code> class provided in <code class="docutils literal notranslate"><span class="pre">CFModel.py</span></code> were designed specifically for <a class="reference external" href="https://colab.research.google.com/github/google/eng-edu/blob/main/ml/recommendation-systems/recommendation-systems.ipynb?utm_source=ss-recommendation-systems&amp;utm_campaign=colab-external&amp;utm_medium=referral&amp;utm_content=recommendation-systems#scrollTo=_BlRIQJYo4tt">Recommendation System Colab</a>, meaning that the length of the embedding vectors were hard-coded in. The inclusion of these two extra parameters allows us to apply this model for new use-cases. In the cell below, we will do a trial run of our model and discuss the results after.</p>
<p><strong>NOTE</strong> I cannot get the below cell to render properly in the online book. Please view my Matrix_Facotrization.ipynb to see the model training graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">rating_matrix</span><span class="p">,</span> <span class="n">num_queries</span><span class="o">=</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_items</span><span class="o">=</span><span class="n">num_artists</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">init_stddev</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:tensorflow:From D:\DCU\4th_year\CA4015\CA4015-Music-RecSystem\book\CFModel.py:55: start_queue_runners (from tensorflow.python.training.queue_runner_impl) is deprecated and will be removed in a future version.
Instructions for updating:
To construct input pipelines, use the `tf.data` module.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:tensorflow:`tf.train.start_queue_runners()` was called when no queue runners were defined. You can safely remove the call to this deprecated function.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 0: train_error=1.000060, test_error=1.000682
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 10: train_error=0.999218, test_error=1.000660
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 20: train_error=0.998363, test_error=1.000624
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 30: train_error=0.997480, test_error=1.000563
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 40: train_error=0.996552, test_error=1.000462
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 50: train_error=0.995559, test_error=1.000302
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 60: train_error=0.994471, test_error=1.000060
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 70: train_error=0.993253, test_error=0.999700
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> iteration 80: train_error=0.991853, test_error=0.999177
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_18420</span><span class="o">/</span><span class="mf">2755676690.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">rating_matrix</span><span class="p">,</span> <span class="n">num_queries</span><span class="o">=</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_items</span><span class="o">=</span><span class="n">num_artists</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">init_stddev</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

<span class="nn">D:\DCU\4th_year\CA4015\CA4015-Music-RecSystem\book\CFModel.py</span> in <span class="ni">train</span><span class="nt">(self, num_iterations, learning_rate, plot_results, optimizer)</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span>             <span class="c1"># Train and append results.</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span>             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">65</span>                 <span class="n">_</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">run</span><span class="p">((</span><span class="n">train_op</span><span class="p">,</span> <span class="n">metrics</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span>                 <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="n">num_iterations</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>                     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2"> iteration </span><span class="si">%d</span><span class="s2">: &quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>

<span class="nn">~\AppData\Roaming\Python\Python38\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">run</span><span class="nt">(self, fetches, feed_dict, options, run_metadata)</span>
<span class="g g-Whitespace">    </span><span class="mi">968</span> 
<span class="g g-Whitespace">    </span><span class="mi">969</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">970</span>       <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">fetches</span><span class="p">,</span> <span class="n">feed_dict</span><span class="p">,</span> <span class="n">options_ptr</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">971</span>                          <span class="n">run_metadata_ptr</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">972</span>       <span class="k">if</span> <span class="n">run_metadata</span><span class="p">:</span>

<span class="nn">~\AppData\Roaming\Python\Python38\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">_run</span><span class="nt">(self, handle, fetches, feed_dict, options, run_metadata)</span>
<span class="g g-Whitespace">   </span><span class="mi">1191</span>     <span class="c1"># or if the call is a partial run that specifies feeds.</span>
<span class="g g-Whitespace">   </span><span class="mi">1192</span>     <span class="k">if</span> <span class="n">final_fetches</span> <span class="ow">or</span> <span class="n">final_targets</span> <span class="ow">or</span> <span class="p">(</span><span class="n">handle</span> <span class="ow">and</span> <span class="n">feed_dict_tensor</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1193</span>       <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_run</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">final_targets</span><span class="p">,</span> <span class="n">final_fetches</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1194</span>                              <span class="n">feed_dict_tensor</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">run_metadata</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1195</span>     <span class="k">else</span><span class="p">:</span>

<span class="nn">~\AppData\Roaming\Python\Python38\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">_do_run</span><span class="nt">(self, handle, target_list, fetch_list, feed_dict, options, run_metadata)</span>
<span class="g g-Whitespace">   </span><span class="mi">1371</span> 
<span class="g g-Whitespace">   </span><span class="mi">1372</span>     <span class="k">if</span> <span class="n">handle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1373</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_call</span><span class="p">(</span><span class="n">_run_fn</span><span class="p">,</span> <span class="n">feeds</span><span class="p">,</span> <span class="n">fetches</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1374</span>                            <span class="n">run_metadata</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1375</span>     <span class="k">else</span><span class="p">:</span>

<span class="nn">~\AppData\Roaming\Python\Python38\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">_do_call</span><span class="nt">(self, fn, *args)</span>
<span class="g g-Whitespace">   </span><span class="mi">1378</span>   <span class="k">def</span> <span class="nf">_do_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1379</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1380</span>       <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1381</span>     <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">OpError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1382</span>       <span class="n">message</span> <span class="o">=</span> <span class="n">compat</span><span class="o">.</span><span class="n">as_text</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

<span class="nn">~\AppData\Roaming\Python\Python38\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">_run_fn</span><span class="nt">(feed_dict, fetch_list, target_list, options, run_metadata)</span>
<span class="g g-Whitespace">   </span><span class="mi">1361</span>       <span class="c1"># Ensure any changes to the graph are reflected in the runtime.</span>
<span class="g g-Whitespace">   </span><span class="mi">1362</span>       <span class="bp">self</span><span class="o">.</span><span class="n">_extend_graph</span><span class="p">()</span>
<span class="ne">-&gt; </span><span class="mi">1363</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_tf_sessionrun</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">feed_dict</span><span class="p">,</span> <span class="n">fetch_list</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1364</span>                                       <span class="n">target_list</span><span class="p">,</span> <span class="n">run_metadata</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1365</span> 

<span class="nn">~\AppData\Roaming\Python\Python38\site-packages\tensorflow\python\client\session.py</span> in <span class="ni">_call_tf_sessionrun</span><span class="nt">(self, options, feed_dict, fetch_list, target_list, run_metadata)</span>
<span class="g g-Whitespace">   </span><span class="mi">1454</span>   <span class="k">def</span> <span class="nf">_call_tf_sessionrun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">feed_dict</span><span class="p">,</span> <span class="n">fetch_list</span><span class="p">,</span> <span class="n">target_list</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1455</span>                           <span class="n">run_metadata</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1456</span>     <span class="k">return</span> <span class="n">tf_session</span><span class="o">.</span><span class="n">TF_SessionRun_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">feed_dict</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1457</span>                                             <span class="n">fetch_list</span><span class="p">,</span> <span class="n">target_list</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1458</span>                                             <span class="n">run_metadata</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>In the above graph, it can be observed that both <code class="docutils literal notranslate"><span class="pre">train_eror</span></code> and <code class="docutils literal notranslate"><span class="pre">test_error</span></code> are small values, indicating good performance of the model overall. However, we already know that the recommendations for this basic model will likely be poor.</p>
<p>Let’s take a closer look at our embeddings. We’ll view the embeddings near ‘Adele’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">item_neighbors</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">title_substring</span><span class="o">=</span><span class="s2">&quot;Adele&quot;</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="s1">&#39;dot&#39;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">artists</span><span class="p">)</span>
<span class="n">item_neighbors</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">title_substring</span><span class="o">=</span><span class="s2">&quot;Adele&quot;</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">artists</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Adele.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dot score</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1919</th>
      <td>1.204</td>
      <td>Adele</td>
    </tr>
    <tr>
      <th>1234</th>
      <td>1.142</td>
      <td>Mika</td>
    </tr>
    <tr>
      <th>526</th>
      <td>1.141</td>
      <td>Little Boots</td>
    </tr>
    <tr>
      <th>542</th>
      <td>1.140</td>
      <td>Ellie Goulding</td>
    </tr>
    <tr>
      <th>2506</th>
      <td>1.137</td>
      <td>Spice Girls</td>
    </tr>
    <tr>
      <th>1571</th>
      <td>1.135</td>
      <td>Paris Hilton</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Adele.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cosine score</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1919</th>
      <td>1.000</td>
      <td>Adele</td>
    </tr>
    <tr>
      <th>259</th>
      <td>0.948</td>
      <td>CÃ©line Dion</td>
    </tr>
    <tr>
      <th>8388</th>
      <td>0.942</td>
      <td>Frankmusik</td>
    </tr>
    <tr>
      <th>542</th>
      <td>0.938</td>
      <td>Ellie Goulding</td>
    </tr>
    <tr>
      <th>2483</th>
      <td>0.938</td>
      <td>Basshunter</td>
    </tr>
    <tr>
      <th>2506</th>
      <td>0.938</td>
      <td>Spice Girls</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="current-model-predictions">
<h2>Current Model Predictions<a class="headerlink" href="#current-model-predictions" title="Permalink to this headline">¶</a></h2>
<p>At a glance, the embeddings closest to Adele seem reasonable, in the sense that they are all popular artist names that are somewhat familiar. This makes sense, Adele being one of the most popular artists in 2011.</p>
<p>With basic recommendation systems, we often observe the appearance of ‘niche’ items (artists in our case) near our embeddings. This is due to the fact that these little-known artists can have a randomly assigned norm with a high value that is never corrected. We somewhat avoid this issue in our model generation by incorporating a relatively small <code class="docutils literal notranslate"><span class="pre">init_stddev</span></code> value of 0.05.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">CFUtils</span> <span class="kn">import</span> <span class="n">tsne_item_embeddings</span><span class="p">,</span> <span class="n">visualize_item_embeddings</span><span class="p">,</span> <span class="n">item_embedding_norm</span><span class="p">,</span> <span class="n">build_regularized_model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">item_embedding_norm</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">artist_tot_listens</span><span class="p">,</span> <span class="n">rating_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Matrix_Factorization_29_0.png" src="_images/Matrix_Factorization_29_0.png" />
</div>
</div>
</div>
<div class="section" id="norm-analysis">
<h2>Norm Analysis<a class="headerlink" href="#norm-analysis" title="Permalink to this headline">¶</a></h2>
<p>Viewing the relation between the number of users who listen to an artist and that artist’s norm, we see that our norm values are somewhat reasonable. The values seem to plateaux near the top. This results in lesser known artists unreasonably receiving higher norm values. Again, instantiating the norms using a normal distribution with a small standard deviation ensures that few niche artists receive high norms. This does not completely solve the issue.</p>
<p>To correct this behaviour, we can use regularization terms. Regularization terms introduce some bias in to our data which aims to reduce the impact of the behaviour previously discussed. We should expect to see less-performant error scores for our regularized model. This is okay however, as we should see improved recommendations being made.</p>
</div>
<hr class="docutils" />
<div class="section" id="regularisation">
<h2>Regularisation<a class="headerlink" href="#regularisation" title="Permalink to this headline">¶</a></h2>
<p>We’ll now use two regularization techniques defined and discussed in our introduction section. Namely, <em>L2 Regularization</em>, and <em>Gravity Term</em> regularization. Essentially, these two terms aim to correct embeddings after they are initialised.</p>
<p>Our <code class="docutils literal notranslate"><span class="pre">build_regularized_model()</span></code> helper function defines both of our regularization terms and combines them into our <code class="docutils literal notranslate"><span class="pre">total_loss</span></code> function which is then provided to our <code class="docutils literal notranslate"><span class="pre">CFModel</span></code> class in place of the previous simplistic loss function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg_model</span> <span class="o">=</span> <span class="n">build_regularized_model</span><span class="p">(</span>
    <span class="n">rating_matrix</span><span class="p">,</span> <span class="n">num_queries</span><span class="o">=</span><span class="n">num_users</span> <span class="p">,</span> <span class="n">num_items</span><span class="o">=</span><span class="n">num_artists</span><span class="p">,</span> <span class="n">regularization_coeff</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">gravity_coeff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">embedding_dim</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">init_stddev</span><span class="o">=.</span><span class="mi">05</span><span class="p">)</span>
<span class="n">reg_model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">num_iterations</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">20.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:tensorflow:From D:\DCU\4th_year\CA4015\CA4015-Music-RecSystem\book\CFModel.py:55: start_queue_runners (from tensorflow.python.training.queue_runner_impl) is deprecated and will be removed in a future version.
Instructions for updating:
To construct input pipelines, use the `tf.data` module.
WARNING:tensorflow:`tf.train.start_queue_runners()` was called when no queue runners were defined. You can safely remove the call to this deprecated function.
 iteration 2000: train_error_observed=0.296637, test_error_observed=0.326611, observed_loss=0.296637, regularization_loss=0.209359, gravity_loss=0.034404
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[{&#39;train_error_observed&#39;: 0.29663688, &#39;test_error_observed&#39;: 0.32661134},
 {&#39;observed_loss&#39;: 0.29663688,
  &#39;regularization_loss&#39;: 0.20935923,
  &#39;gravity_loss&#39;: 0.034403637}]
</pre></div>
</div>
<img alt="_images/Matrix_Factorization_31_2.png" src="_images/Matrix_Factorization_31_2.png" />
</div>
</div>
<div class="section" id="regularised-model-analysis">
<h3>Regularised Model Analysis<a class="headerlink" href="#regularised-model-analysis" title="Permalink to this headline">¶</a></h3>
<p>If we compare the graph on the left of our regularised model to the graph of our unregularised model, we can see that our regularised model has higher loss values. Higher loss values for an MF recommender system can be favourable to a certain degree. This is because our scoring functions (“DOT” and “COSINE”) regularly make recommendations for items based on popularity. It’s important for recommendation systems to include some type of personalisation in their recommendations, otherwise they will just recommend the most popular items to all users, which is useful to no one.</p>
<hr class="docutils" />
<p>As before, we can now take a closer look at our embeddings. Let’s once again view the embeddings near Adele, and try to interpret and compare them to our previous embeddings for our unregularised model. Let’s first inspect the dot product as our measure, followed by cosine.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">item_neighbors</span><span class="p">(</span><span class="n">reg_model</span><span class="p">,</span><span class="n">title_substring</span><span class="o">=</span><span class="s2">&quot;Adele&quot;</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="s1">&#39;dot&#39;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">artists</span><span class="p">)</span>
<span class="n">item_neighbors</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">title_substring</span><span class="o">=</span><span class="s2">&quot;Adele&quot;</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="s1">&#39;dot&#39;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">artists</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Adele.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dot score</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>83</th>
      <td>4.443</td>
      <td>Lady Gaga</td>
    </tr>
    <tr>
      <th>61</th>
      <td>4.409</td>
      <td>Madonna</td>
    </tr>
    <tr>
      <th>283</th>
      <td>4.404</td>
      <td>Britney Spears</td>
    </tr>
    <tr>
      <th>282</th>
      <td>4.375</td>
      <td>Rihanna</td>
    </tr>
    <tr>
      <th>294</th>
      <td>4.375</td>
      <td>Katy Perry</td>
    </tr>
    <tr>
      <th>327</th>
      <td>4.375</td>
      <td>Avril Lavigne</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Adele.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dot score</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1919</th>
      <td>1.196</td>
      <td>Adele</td>
    </tr>
    <tr>
      <th>1444</th>
      <td>1.168</td>
      <td>Selena Gomez</td>
    </tr>
    <tr>
      <th>334</th>
      <td>1.164</td>
      <td>Cher</td>
    </tr>
    <tr>
      <th>518</th>
      <td>1.161</td>
      <td>Jeffree Star</td>
    </tr>
    <tr>
      <th>303</th>
      <td>1.153</td>
      <td>Danity Kane</td>
    </tr>
    <tr>
      <th>1449</th>
      <td>1.152</td>
      <td>Miranda Cosgrove</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="dot-product-comparison-of-embeddings-in-regularised-and-unregularised">
<h3>Dot Product Comparison of Embeddings in Regularised and Unregularised<a class="headerlink" href="#dot-product-comparison-of-embeddings-in-regularised-and-unregularised" title="Permalink to this headline">¶</a></h3>
<p>I think it’s clear that although both models do make somewhat reasonable recommendations, the more appropriate embedding space is definitely found in the regularised model. The unregularised model seems to make less useful recommendations such as ‘Miranda Cosgrove’, and ‘Jefree Star’. The regularised model returns popular, solo-female artists that may not make music exactly similar to Adele, but were equally as popular as Adele in 2011.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">item_neighbors</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">title_substring</span><span class="o">=</span><span class="s2">&quot;Adele&quot;</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">artists</span><span class="p">)</span>
<span class="n">item_neighbors</span><span class="p">(</span><span class="n">reg_model</span><span class="p">,</span> <span class="n">title_substring</span><span class="o">=</span><span class="s2">&quot;Adele&quot;</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="n">artists</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Adele.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cosine score</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1919</th>
      <td>1.000</td>
      <td>Adele</td>
    </tr>
    <tr>
      <th>1444</th>
      <td>0.954</td>
      <td>Selena Gomez</td>
    </tr>
    <tr>
      <th>1449</th>
      <td>0.951</td>
      <td>Miranda Cosgrove</td>
    </tr>
    <tr>
      <th>518</th>
      <td>0.950</td>
      <td>Jeffree Star</td>
    </tr>
    <tr>
      <th>532</th>
      <td>0.950</td>
      <td>Maroon 5</td>
    </tr>
    <tr>
      <th>680</th>
      <td>0.949</td>
      <td>Selena Gomez &amp; the Scene</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nearest neighbors of : Adele.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cosine score</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1919</th>
      <td>1.000</td>
      <td>Adele</td>
    </tr>
    <tr>
      <th>673</th>
      <td>0.999</td>
      <td>Glee Cast</td>
    </tr>
    <tr>
      <th>542</th>
      <td>0.999</td>
      <td>Ellie Goulding</td>
    </tr>
    <tr>
      <th>91</th>
      <td>0.999</td>
      <td>Duffy</td>
    </tr>
    <tr>
      <th>1043</th>
      <td>0.999</td>
      <td>Pink</td>
    </tr>
    <tr>
      <th>3061</th>
      <td>0.999</td>
      <td>Sara Bareilles</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="cosine-comparison-of-embeddings-in-regularised-and-unregularised">
<h3>Cosine Comparison of Embeddings in Regularised and Unregularised<a class="headerlink" href="#cosine-comparison-of-embeddings-in-regularised-and-unregularised" title="Permalink to this headline">¶</a></h3>
<p>We see a similar behaviour here, in that the regularised model embeddings are clearly more suitable. The appearance of <em>Glee Cast</em> as the most similar artist to Adele did seem like a strange recommendation. However, I found an <a class="reference external" href="https://tvline.com/2011/11/17/glee-adele-rumor-has-it-someone-like-you/">article</a> that gives meaning to this recommendation. In 2011, Glee aired a mash-up of Adele’s “Rumor Has It / Someone Like You” in one of their episodes which saw their iTunes song release reach No.1 on the charts.</p>
<p>Once again, we see the regularised model recommending popular solo-female artists from that time. Both cosine and dot product recommendations seem suitable for Adele.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="norm-embedding-analysis">
<h2>Norm Embedding Analysis<a class="headerlink" href="#norm-embedding-analysis" title="Permalink to this headline">¶</a></h2>
<p>As previously, we will now view our model embeddings. We can see in the below image that the regularised model was able to break the plateaux previously observed in the unregularised model. As a result, this model is able to give more appropriate recommendations.</p>
<p>The below graph visually shows an improvement over our unregularised model. We see that embeddings no longer plateaux beyond a certain point, which leads to better recommendations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">item_embedding_norm</span><span class="p">(</span><span class="n">reg_model</span><span class="p">,</span> <span class="n">artist_tot_listens</span><span class="p">,</span> <span class="n">rating_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Matrix_Factorization_37_0.png" src="_images/Matrix_Factorization_37_0.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="Preliminary_Data_Analysis.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Preliminary Data Analysis</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="Deep_Learning_Recommender_System.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Deep Neural Network Recommender System</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Sean Cummins<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>